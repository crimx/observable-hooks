<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>核心 API | Observable Hooks</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="React hooks for RxJS Observables. 简洁、灵活、可测试且注重性能。">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
    <meta name="theme-color" content="#9B59B6">
    
    <link rel="preload" href="/assets/css/0.styles.d1126fd2.css" as="style"><link rel="preload" href="/assets/js/app.9db4870b.js" as="script"><link rel="preload" href="/assets/js/2.393da890.js" as="script"><link rel="preload" href="/assets/js/1.05c5d22f.js" as="script"><link rel="preload" href="/assets/js/37.493f2dcd.js" as="script"><link rel="preload" href="/assets/js/4.7886ae13.js" as="script"><link rel="preload" href="/assets/js/18.d18af064.js" as="script"><link rel="prefetch" href="/assets/js/10.a64fa3d4.js"><link rel="prefetch" href="/assets/js/11.3a01efaf.js"><link rel="prefetch" href="/assets/js/12.29be64e5.js"><link rel="prefetch" href="/assets/js/13.42ba676b.js"><link rel="prefetch" href="/assets/js/14.4c8496b0.js"><link rel="prefetch" href="/assets/js/15.c4943164.js"><link rel="prefetch" href="/assets/js/16.80fff533.js"><link rel="prefetch" href="/assets/js/17.0b06748a.js"><link rel="prefetch" href="/assets/js/19.d4d6c946.js"><link rel="prefetch" href="/assets/js/20.72b8423c.js"><link rel="prefetch" href="/assets/js/21.a513cdb7.js"><link rel="prefetch" href="/assets/js/22.c541a2d5.js"><link rel="prefetch" href="/assets/js/23.6baf0ac4.js"><link rel="prefetch" href="/assets/js/24.66c3f1f1.js"><link rel="prefetch" href="/assets/js/25.4110a808.js"><link rel="prefetch" href="/assets/js/26.031ea384.js"><link rel="prefetch" href="/assets/js/27.7067e67d.js"><link rel="prefetch" href="/assets/js/28.9f7d9870.js"><link rel="prefetch" href="/assets/js/29.55429919.js"><link rel="prefetch" href="/assets/js/3.95177359.js"><link rel="prefetch" href="/assets/js/30.80138b5f.js"><link rel="prefetch" href="/assets/js/31.29314d8c.js"><link rel="prefetch" href="/assets/js/32.3eabc19a.js"><link rel="prefetch" href="/assets/js/33.7b76382b.js"><link rel="prefetch" href="/assets/js/34.0bd17aa5.js"><link rel="prefetch" href="/assets/js/35.437dbda7.js"><link rel="prefetch" href="/assets/js/36.5b24e5bb.js"><link rel="prefetch" href="/assets/js/38.b612a8ed.js"><link rel="prefetch" href="/assets/js/39.ec37a971.js"><link rel="prefetch" href="/assets/js/40.b1d1ee45.js"><link rel="prefetch" href="/assets/js/41.d688b579.js"><link rel="prefetch" href="/assets/js/42.9d321ee5.js"><link rel="prefetch" href="/assets/js/43.23fa6ef9.js"><link rel="prefetch" href="/assets/js/44.d23e3417.js"><link rel="prefetch" href="/assets/js/45.598832d1.js"><link rel="prefetch" href="/assets/js/46.d10ce16f.js"><link rel="prefetch" href="/assets/js/47.1b1276e1.js"><link rel="prefetch" href="/assets/js/48.22871051.js"><link rel="prefetch" href="/assets/js/49.7fb2b43a.js"><link rel="prefetch" href="/assets/js/5.99acf38d.js"><link rel="prefetch" href="/assets/js/50.4179183e.js"><link rel="prefetch" href="/assets/js/51.6952c8d8.js"><link rel="prefetch" href="/assets/js/52.c7df83f6.js"><link rel="prefetch" href="/assets/js/53.3b520dd4.js"><link rel="prefetch" href="/assets/js/6.041d4ece.js"><link rel="prefetch" href="/assets/js/7.2faa9701.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5a4296f1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d1126fd2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh-cn/" class="home-link router-link-active"><!----> <span class="site-name">Observable Hooks</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh-cn/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/zh-cn/api/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  API
</a></div><div class="nav-item"><a href="/zh-cn/examples/" class="nav-link">
  样例
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="简体中文" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="简体中文" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/api/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh-cn/api/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/crimx/observable-hooks" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh-cn/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/zh-cn/api/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  API
</a></div><div class="nav-item"><a href="/zh-cn/examples/" class="nav-link">
  样例
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="简体中文" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="简体中文" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/api/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh-cn/api/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/crimx/observable-hooks" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>API 参考</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh-cn/api/" aria-current="page" class="active sidebar-link">核心 API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh-cn/api/#useobservable" class="sidebar-link">useObservable</a></li><li class="sidebar-sub-header"><a href="/zh-cn/api/#uselayoutobservable" class="sidebar-link">useLayoutObservable</a></li><li class="sidebar-sub-header"><a href="/zh-cn/api/#useobservablecallback" class="sidebar-link">useObservableCallback</a></li><li class="sidebar-sub-header"><a href="/zh-cn/api/#useobservableref" class="sidebar-link">useObservableRef</a></li><li class="sidebar-sub-header"><a href="/zh-cn/api/#usesubscription" class="sidebar-link">useSubscription</a></li><li class="sidebar-sub-header"><a href="/zh-cn/api/#uselayoutsubscription" class="sidebar-link">useLayoutSubscription</a></li><li class="sidebar-sub-header"><a href="/zh-cn/api/#useobservablestate" class="sidebar-link">useObservableState</a></li><li class="sidebar-sub-header"><a href="/zh-cn/api/#useobservableeagerstate" class="sidebar-link">useObservableEagerState</a></li><li class="sidebar-sub-header"><a href="/zh-cn/api/#uselayoutobservablestate" class="sidebar-link">useLayoutObservableState</a></li><li class="sidebar-sub-header"><a href="/zh-cn/api/#useobservablegetstate" class="sidebar-link">useObservableGetState</a></li><li class="sidebar-sub-header"><a href="/zh-cn/api/#useobservablepickstate" class="sidebar-link">useObservablePickState</a></li><li class="sidebar-sub-header"><a href="/zh-cn/api/#userenderthrow" class="sidebar-link">useRenderThrow</a></li></ul></li><li><a href="/zh-cn/api/suspense.html" class="sidebar-link">Suspense</a></li><li><a href="/zh-cn/api/helpers.html" class="sidebar-link">辅助方法</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="核心-api"><a href="#核心-api" class="header-anchor">#</a> 核心 API</h1> <h2 id="useobservable"><a href="#useobservable" class="header-anchor">#</a> useObservable</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token generic-function"><span class="token function">useObservable</span><span class="token generic class-name"><span class="token operator">&lt;</span>TOutput<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TOutput<span class="token operator">&gt;</span>
<span class="token generic-function"><span class="token function">useObservable</span><span class="token generic class-name"><span class="token operator">&lt;</span>TOutput<span class="token punctuation">,</span> TInputs<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  <span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">,</span>
  inputs<span class="token operator">:</span> TInputs
<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TOutput<span class="token operator">&gt;</span>
</code></pre></div><p>React 函数组件每次计算渲染时都会被调用。利用 <code>useObservable</code> 创建或转换 Observables 以避免操作被反复执行。</p> <p>参数接受一个返回 Observable 的类 epic 函数 <code>init</code>，以及一个可选的依赖数组。数组会被传到一个 Observable 并交给 <code>init</code> 函数。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>因为 <code>init</code> 函数只会执行一遍，在里面通过闭包直接访问其它变量可能会不安全。见<a href="/zh-cn/guide/gotchas.html">注意事项</a>。</p></div> <div class="custom-block warning"><p class="custom-block-title">依赖数组限制</p> <p>依赖数组在内部将直接传给 <a href="https://reactjs.org/docs/hooks-reference.html#conditionally-firing-an-effect" target="_blank" rel="noopener noreferrer"><code>useEffect</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，故需要遵循同样的限制。比如数组的长度不能改变。</p></div> <p><strong>类型参数:</strong></p> <ul><li><code>TOutput</code> 输出 Observable 的值类型</li> <li><code>TInputs</code> 依赖元组</li></ul> <p><strong>参数:</strong></p> <table><thead><tr><th>参数名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>init</code></td> <td><code>(inputs$: Observable&lt;TInputs&gt;): Observable&lt;TOutput&gt;</code></td> <td>一个纯函数，接收一个 Observable，返回一个 Observable。</td></tr> <tr><td><code>inputs</code></td> <td><code>TInputs</code></td> <td>可选的依赖数组。当数组中的一个项发生改变时 <code>init</code> 中的 Observable 会产生一个值，其值为整个依赖数组。</td></tr></tbody></table> <p><strong>返回值:</strong></p> <p><code>Observable&lt;TOutput&gt;</code> 总会返回同一个 Observable。</p> <p><strong>例子:</strong></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">CompProps</span> <span class="token punctuation">{</span>
  isOpen<span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Comp<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>CompProps<span class="token operator">&gt;</span> <span class="token operator">=</span> props <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>showPanel<span class="token punctuation">,</span> setShowPanel<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

  <span class="token comment">// 监听 props 或 state 变化</span>
  <span class="token keyword">const</span> enhanced$ <span class="token operator">=</span> <span class="token function">useObservable</span><span class="token punctuation">(</span>
    inputs$ <span class="token operator">=&gt;</span> inputs$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>isOpen<span class="token punctuation">,</span> showPanel<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> isOpen <span class="token operator">&amp;&amp;</span> showPanel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>props<span class="token punctuation">.</span>isOpen<span class="token punctuation">,</span> showPanel<span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>创建 Observable：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> now$ <span class="token operator">=</span> <span class="token function">useObservable</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>操作 Observable：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// outers$ are created from other React-unrelated module</span>
<span class="token keyword">const</span> enhanced$ <span class="token operator">=</span> <span class="token function">useObservable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> outers$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">mapTo</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>也可以结合一起：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> enhanced$ <span class="token operator">=</span> <span class="token function">useObservable</span><span class="token punctuation">(</span>
  inputs$ <span class="token operator">=&gt;</span> isEven$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">withLatestFrom</span><span class="token punctuation">(</span>inputs$<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>isEven<span class="token punctuation">,</span> <span class="token punctuation">[</span>isOpen<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> isEven <span class="token operator">&amp;&amp;</span> isOpen<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>props<span class="token punctuation">.</span>isOpen<span class="token punctuation">]</span>
<span class="token punctuation">)</span>
</code></pre></div><h2 id="uselayoutobservable"><a href="#uselayoutobservable" class="header-anchor">#</a> useLayoutObservable</h2> <p>与 <a href="#useobservable"><code>useObservable</code></a> 基本一样，不同的是底下使用 <a href="https://reactjs.org/docs/hooks-reference.html#uselayouteffect" target="_blank" rel="noopener noreferrer"><code>useLayoutEffect</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 监听改变。</p> <p>如果需要在下次浏览器绘制前拿到值可以用它。</p> <h2 id="useobservablecallback"><a href="#useobservablecallback" class="header-anchor">#</a> useObservableCallback</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token generic-function"><span class="token function">useObservableCallback</span><span class="token generic class-name"><span class="token operator">&lt;</span>TOutput<span class="token punctuation">,</span> TInput<span class="token punctuation">,</span> TParams<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  init<span class="token operator">?</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">,</span>
  selector<span class="token operator">?</span><span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">function</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">function</span><span class="token punctuation">,</span> Observable<span class="token operator">&lt;</span>TOutput<span class="token operator">&gt;</span><span class="token punctuation">]</span>
</code></pre></div><p>返回一个回调函数以及一个事件 Observable。每当回调被调用，Observable 会产生一个值，其值为回调接收的第一个参数。</p> <p><span class="badge tip" style="vertical-align:top;" data-v-59f00772>v2.1.0</span> 添加自 <code>v2.1.0</code> 同时接受一个可选的选择函数以支持多参数事件。回调函数每次接受的所有参数将作为数组交给这个函数，返回一个值交给 Observable。
</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果你需要直接得到 state 值而不是一个 Observable 见 <a href="#useobservablestate">useObservableState</a>。</p></div> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>因为 <code>init</code> 函数只会执行一遍，在里面通过闭包直接访问其它变量可能会不安全。见<a href="/zh-cn/guide/gotchas.html">注意事项</a>。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在 TypeScript 中如果想要回调不接受任何参数，用 <code>void</code> 类型定义而不是 <code>undefined</code>。</p></div> <p><strong>类型参数:</strong></p> <ul><li><code>TOutput</code> 输出 Observable 的值类型</li> <li><code>TInput</code> 输入 Observable 的值类型</li> <li><code>TParams</code> 回调函数参数类型数组</li></ul> <p><strong>参数:</strong></p> <table><thead><tr><th>参数名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>init</code></td> <td><code>(inputs$: Observable&lt;TInputs&gt;): Observable&lt;TOutput&gt;</code></td> <td>一个纯函数，接收一个 Observable，返回一个 Observable。</td></tr> <tr><td><code>selector</code></td> <td><code>(args: TParams): TInput</code></td> <td>可选的函数，接受一个数组包含每次所有的参数，返回单一值。</td></tr></tbody></table> <p><strong>返回值:</strong></p> <p><code>[(...args: TParams): void, Observable&lt;TOutput&gt;]</code> 一个元组，包含一个回调和一个 Observable。</p> <p><strong>例子:</strong></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useObservableCallback<span class="token punctuation">,</span> useSubscription <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'observable-hooks'</span>

<span class="token keyword">const</span> <span class="token function-variable function">Comp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>onChange<span class="token punctuation">,</span> textChange$<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useObservableCallback</span><span class="token generic class-name"><span class="token operator">&lt;</span>
    <span class="token builtin">string</span><span class="token punctuation">,</span>
    React<span class="token punctuation">.</span>FormEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">&gt;</span>
  <span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>event$ <span class="token operator">=&gt;</span> event$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">pluck</span><span class="token punctuation">(</span><span class="token string">'currentTarget'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 或者直接用 &quot;pluckCurrentTargetValue&quot; 方法</span>

  <span class="token function">useSubscription</span><span class="token punctuation">(</span>textChange$<span class="token punctuation">,</span> <span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>转换回调多个参数：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useObservableCallback<span class="token punctuation">,</span> identity <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'observable-hooks'</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>onResize<span class="token punctuation">,</span> height$<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useObservableCallback</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  <span class="token builtin">number</span><span class="token punctuation">,</span>
  <span class="token builtin">number</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>identity<span class="token punctuation">,</span> args <span class="token operator">=&gt;</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// onResize 接收到 width 和 hegiht</span>
<span class="token comment">// height$ 得到 height 的值</span>
<span class="token function">onResize</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="useobservableref"><a href="#useobservableref" class="header-anchor">#</a> useObservableRef</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token generic-function"><span class="token function">useObservableRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>TValue<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  initialValue<span class="token operator">:</span> TValue
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span>MutableRefObject<span class="token operator">&lt;</span>TValue<span class="token operator">&gt;</span><span class="token punctuation">,</span> BehaviorSubject<span class="token operator">&lt;</span>TValue<span class="token operator">&gt;</span><span class="token punctuation">]</span>
<span class="token generic-function"><span class="token function">useObservableRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>TValue<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  initialValue<span class="token operator">:</span> TValue <span class="token operator">|</span> <span class="token keyword">null</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span>RefObject<span class="token operator">&lt;</span>TValue<span class="token operator">&gt;</span><span class="token punctuation">,</span> BehaviorSubject<span class="token operator">&lt;</span>TValue<span class="token operator">&gt;</span><span class="token punctuation">]</span>
<span class="token generic-function"><span class="token function">useObservableRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>TValue <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  initialValue<span class="token operator">?</span><span class="token operator">:</span> TValue
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span>MutableRefObject<span class="token operator">&lt;</span>TValue <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> BehaviorSubject<span class="token operator">&lt;</span>TValue <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
</code></pre></div><p>返回一个 ref 对象和一个 BehaviorSubject。每当 ref.current 改变，BehaviorSubject 会发出新的值。</p> <span class="badge tip" style="vertical-align:top;" data-v-59f00772>v4.2.2</span> 添加自 v4.2.2.
<p><strong>类型参数:</strong></p> <ul><li><code>TValue</code> Ref 值类型.</li></ul> <p><strong>参数:</strong></p> <table><thead><tr><th>参数名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>initialValue</code></td> <td><code>TValue</code></td> <td>可选的初始值。</td></tr></tbody></table> <p><strong>返回值:</strong></p> <p><code>[MutableRefObject&lt;TValue&gt;, BehaviorSubject&lt;TValue&gt;]</code> 一个元组，包含一个 ref 对象和一个 BehaviorSubject。</p> <p><strong>例子:</strong></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">Comp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>elRef<span class="token punctuation">,</span> el$<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useObservableRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

  <span class="token function">useSubscription</span><span class="token punctuation">(</span>el$<span class="token punctuation">,</span> <span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>elRef<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Content</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">Comp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>ref<span class="token punctuation">,</span> value$<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useObservableRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token function">useSubscription</span><span class="token punctuation">(</span>value$<span class="token punctuation">,</span> <span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ref<span class="token punctuation">.</span>current<span class="token operator">++</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Click</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="usesubscription"><a href="#usesubscription" class="header-anchor">#</a> useSubscription</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token generic-function"><span class="token function">useSubscription</span><span class="token generic class-name"><span class="token operator">&lt;</span>TInput<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  input$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TInput<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  observer<span class="token operator">?</span><span class="token operator">:</span> PartialObserver<span class="token operator">&lt;</span>TInput<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token operator">:</span> React<span class="token punctuation">.</span>MutableRefObject<span class="token operator">&lt;</span>Subscription <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span>
<span class="token generic-function"><span class="token function">useSubscription</span><span class="token generic class-name"><span class="token operator">&lt;</span>TInput<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  input$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TInput<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  next<span class="token operator">?</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  error<span class="token operator">?</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  complete<span class="token operator">?</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token keyword">undefined</span>
<span class="token punctuation">)</span><span class="token operator">:</span> React<span class="token punctuation">.</span>MutableRefObject<span class="token operator">&lt;</span>Subscription <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span>
</code></pre></div><p>订阅 Observable，在并行模式下安全。</p> <p>接受可选的 observer 对象或者可选的 <code>next</code>、 <code>error</code>、 <code>complete</code> 回调。如果选择后者则必须保持顺序，用 <code>undefined</code> 或者 <code>null</code> 占位。</p> <p>为什么不能直接用 <code>useEffect</code>？</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">useEffect</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> subscription <span class="token operator">=</span> input$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token operator">...</span><span class="token punctuation">,</span>
      <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token operator">...</span><span class="token punctuation">,</span>
      <span class="token literal-property property">complete</span><span class="token operator">:</span> <span class="token operator">...</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      subscription<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>input$<span class="token punctuation">]</span>
<span class="token punctuation">)</span>
</code></pre></div><p>因为：</p> <ol><li>回调闭包引用的值会过期，导致回调被调用时拿不到组件最新的值。</li> <li>并行模式下不安全。Observable 改变时可能会产生状态不同步的“撕裂”现象。</li></ol> <p><span class="badge tip" style="vertical-align:top;" data-v-59f00772>v2.0.0</span> 添加自 <code>v2.0.0</code>。 <code>useSubscription</code> 会保证被调用的是最新的回调。你可以放心地在回调中通过闭包引用任何变量。
</p> <p><span class="badge tip" style="vertical-align:top;" data-v-59f00772>v2.3.4</span> 添加自 <code>v2.3.4</code>。 当 Observable 改变时 <code>useSubscription</code> 会自动取消旧的并订阅新的。
</p> <p><span class="badge tip" style="vertical-align:top;" data-v-59f00772>v3.0.0</span> 添加自 <code>v3.0.0</code>。 <code>useSubscription</code> 在并行模式下安全。它会避免过期的 Observable 触发回调。
</p> <p><span class="badge tip" style="vertical-align:top;" data-v-59f00772>v3.2.0</span> 添加自 <code>v3.2.0</code>。 <code>useSubscription</code> 可以接受一个 observer 对象。非常感谢 <a href="https://github.com/crimx/observable-hooks/pull/38">OliverJAsh</a> 的贡献！
</p> <p>为了兼容并行模式，<code>useSubscription</code> 开始订阅 Observable 的时机是在渲染被绘制到屏幕之后的副作用阶段。故即使 Observable 在订阅时会产生同步的值，这些值也会在第一次渲染之后到达。另外也可以使用针对同步值优化的 <a href="#useobservableeagerstate"><code>useObservableEagerState</code></a>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意 observer 回调发生改变并不会导致被订阅的 Observable 产生新的值。这不太常见但如果需要这种效果可以通过 <a href="#useobservable"><code>useObservable</code></a> 以回调函数为值造一个 Observable。</p></div> <div class="custom-block tip"><p class="custom-block-title">异常处理</p> <p>因为 RxJS 的设计，Observable 一旦产生了异常就会被销毁。你可以：</p> <ul><li>通过在子流中放置 <a href="https://rxjs-dev.firebaseapp.com/api/operators/catchError" target="_blank" rel="noopener noreferrer"><code>catchError</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 避免异常传达主流。</li> <li>也可以将 Observable 作为 state，发生异常时换掉新的。<code>useSubscription</code> 会自动切换。</li> <li>自 <code>v4.2.0</code> 配合 <a href="#userenderthrow"><code>useRenderThrow</code></a> 可以让 Observable 异常被 React 错误边界获取到。你可以在那里做处理并更换被销毁的 Observable。</li></ul></div> <hr> <p><strong>类型参数:</strong></p> <ul><li><code>TInput</code> Input value within Observable.</li></ul> <p><strong>参数:</strong></p> <table><thead><tr><th>参数名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>input$</code></td> <td><code>Observable&lt;TInput&gt;</code></td> <td>Input Observable.</td></tr> <tr><td><code>next</code></td> <td><code>(value: TInput): void | null | undefined</code></td> <td>Notify when a new value is emitted.</td></tr> <tr><td><code>error</code></td> <td><code>(error: any): void | null | undefined</code></td> <td>Notify when a new error is thrown.</td></tr> <tr><td><code>complete</code></td> <td><code>(): void | null | undefined</code></td> <td>Notify when the Observable is complete.</td></tr></tbody></table> <p><strong>返回值:</strong></p> <p><code>React.MutableRefObject&lt;Subscription | undefined&gt;</code> A ref object with the RxJS Subscription. the ref <code>current</code> is <code>undefined</code> on first rendering.</p> <hr> <p><strong>类型参数:</strong></p> <ul><li><code>TInput</code> 输入 Observable 的值类型</li></ul> <p><strong>参数:</strong></p> <table><thead><tr><th>参数名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>input$</code></td> <td><code>Observable&lt;TInput&gt; | null | undefined</code></td> <td>输入 Observable</td></tr> <tr><td><code>observer</code></td> <td><code>PartialObserver&lt;TInput&gt;</code></td> <td>Observer</td></tr></tbody></table> <p><strong>返回值:</strong></p> <p><code>React.MutableRefObject&lt;Subscription | undefined&gt;</code> A ref object with the RxJS Subscription. the ref <code>current</code> is <code>undefined</code> on first rendering.</p> <hr> <p><strong>例子:</strong></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> subscription <span class="token operator">=</span> <span class="token function">useSubscription</span><span class="token punctuation">(</span>events$<span class="token punctuation">,</span> e <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>On complete</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> subscription <span class="token operator">=</span> <span class="token function">useSubscription</span><span class="token punctuation">(</span>events$<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'complete'</span>
</code></pre></div><p>Access closure:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>debug<span class="token punctuation">,</span> setDebug<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> subscription <span class="token operator">=</span> <span class="token function">useSubscription</span><span class="token punctuation">(</span>events$<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>debug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Invoke props callback</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> subscription <span class="token operator">=</span> <span class="token function">useSubscription</span><span class="token punctuation">(</span>events$<span class="token punctuation">,</span> props<span class="token punctuation">.</span>onEvent<span class="token punctuation">)</span>
</code></pre></div><h2 id="uselayoutsubscription"><a href="#uselayoutsubscription" class="header-anchor">#</a> useLayoutSubscription</h2> <p>与 <a href="#usesubscription">useSubscription</a> 一样，除了 subscription 是通过 <code>useLayoutEffect</code> 触发。</p> <p>当需要在 DOM 绘制前拿到值时会有用。</p> <p>尽量少用，因为其是在浏览器绘制前同步调用。过多的同步值产生会延长组件的 commit 周期。</p> <h2 id="useobservablestate"><a href="#useobservablestate" class="header-anchor">#</a> useObservableState</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token generic-function"><span class="token function">useObservableState</span><span class="token generic class-name"><span class="token operator">&lt;</span>TState<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  input$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TState<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token operator">:</span> TState <span class="token operator">|</span> <span class="token keyword">undefined</span>
<span class="token generic-function"><span class="token function">useObservableState</span><span class="token generic class-name"><span class="token operator">&lt;</span>TState<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  input$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TState<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  initialState<span class="token operator">:</span> TState <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TState<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token operator">:</span> TState
<span class="token generic-function"><span class="token function">useObservableState</span><span class="token generic class-name"><span class="token operator">&lt;</span>TState<span class="token punctuation">,</span> TInput <span class="token operator">=</span> TState<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  <span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token punctuation">(</span>input$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TInput<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Observable<span class="token operator">&lt;</span>TState<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span>TState <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>input<span class="token operator">:</span> TInput<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">]</span>
<span class="token generic-function"><span class="token function">useObservableState</span><span class="token generic class-name"><span class="token operator">&lt;</span>TState<span class="token punctuation">,</span> TInput <span class="token operator">=</span> TState<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  <span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token punctuation">(</span>
    input$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TInput<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    initialState<span class="token operator">:</span> TState
  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Observable<span class="token operator">&lt;</span>TState<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  initialState<span class="token operator">:</span> TState <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TState<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span>TState<span class="token punctuation">,</span> <span class="token punctuation">(</span>input<span class="token operator">:</span> TInput<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">]</span>
</code></pre></div><p>并发模式下也能安全地从 Observable 中获取值。前往<a href="/zh-cn/guide/core-concepts.html">核心概念</a>了解此设计原理。</p> <p>它有两种使用方式：</p> <ol><li>传一个 Observable 与一个可选的初始值。<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token function">useObservableState</span><span class="token punctuation">(</span>input$<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span>
</code></pre></div></li> <li>传一个类 epic 的方法与一个可选的初始值.<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>output<span class="token punctuation">,</span> onInput<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useObservableState</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">input$<span class="token punctuation">,</span> initialState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> input$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  initialState
<span class="token punctuation">)</span>
</code></pre></div></li></ol> <p>这两种方式底层使用不同的 hooks，故请勿选了一种方式之后又通过改变参数切换到另一种方式。</p> <p>在内部，可选的 <code>initialState</code> 会被传到 <code>useState(initialState)</code>。故其可以是状态值，也可以是返回状态的函数，以便昂贵计算。</p> <p>同时 <code>initialState</code>（或它的返回值）会被传入到 <code>init</code> 函数。这会很有用如果你想实现 reducer 模式，这种模式下需要一个初始值。</p> <p>为了兼容并行模式，<code>useObservableState</code> 开始订阅 Observable 的时机是在渲染被绘制到屏幕之后的副作用阶段。故即使 Observable 在订阅时会产生同步的值，这些值也会在第一次渲染之后到达。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>因为 <code>init</code> 函数只会执行一遍，在里面通过闭包直接访问其它变量可能会不安全。见<a href="/zh-cn/guide/gotchas.html">注意事项</a>。</p></div> <div class="custom-block tip"><p class="custom-block-title">异常处理</p> <p>因为 RxJS 的设计，Observable 一旦产生了异常就会被销毁。你可以：</p> <ul><li>通过在子流中放置 <a href="https://rxjs-dev.firebaseapp.com/api/operators/catchError" target="_blank" rel="noopener noreferrer"><code>catchError</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 避免异常传达主流。</li> <li>也可以将 Observable 作为 state，发生异常时换掉新的。<code>useSubscription</code> 会自动切换。</li> <li>自 <code>v4.2.0</code> 配合 <a href="#userenderthrow"><code>useRenderThrow</code></a> 可以让 Observable 异常被 React 错误边界获取到。你可以在那里做处理并更换被销毁的 Observable。</li></ul></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果希望针对产生同步值的 Observable 跳过初始的额外一次 re-rendering，可以看看 <a href="#useobservableeagerstate"><code>useObservableEagerState</code></a>。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在 TypeScript 中如果你希望回调接受空参数，请用 <code>void</code> 而不是 <code>undefined</code> 类型。</p></div> <hr> <p><strong>类型参数:</strong></p> <ul><li><code>TState</code> Output state.</li></ul> <p><strong>参数:</strong></p> <table><thead><tr><th>参数名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>input$</code></td> <td><code>Observable&lt;TState&gt;</code></td> <td>一个 Observable。</td></tr> <tr><td><code>initialState</code></td> <td><code>TState | (): TState</code></td> <td>可选的初始状态。可以是状态值或者返回状态值的函数。</td></tr></tbody></table> <p><strong>返回值:</strong></p> <p><code>TState</code> 状态值</p> <hr> <p><strong>类型参数:</strong></p> <ul><li><code>TState</code> 输出的状态</li> <li><code>TInput</code> 输入的状态</li></ul> <p><strong>参数:</strong></p> <table><thead><tr><th>参数名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>init</code></td> <td><code>(input$: Observable&lt;TInput&gt;, initialState: TState): Observable&lt;TState&gt;</code></td> <td>一个纯函数，接收一个 Observable，返回一个 Observable。</td></tr> <tr><td><code>initialState</code></td> <td><code>TState</code></td> <td>可选的初始状态。可以是状态值或者返回状态值的函数。</td></tr></tbody></table> <p><strong>返回值:</strong></p> <p><code>[TState, (input: TInput): void]</code> 一个元组包含状态与输入回调。</p> <hr> <p><strong>例子:</strong></p> <p>接收一个 Observable：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> count$ <span class="token operator">=</span> <span class="token function">useObservable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">useObservableState</span><span class="token punctuation">(</span>count$<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><p>或者接收一个 <code>init</code> 函数：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> updateText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useObservableState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  text$ <span class="token operator">=&gt;</span> text$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">''</span>
<span class="token punctuation">)</span>
</code></pre></div><p>输入和输出状态可以是不同的类型：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// 输入: string, 输出: boolean</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>isValid<span class="token punctuation">,</span> updateText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useObservableState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>text$ <span class="token operator">=&gt;</span>
  text$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>text <span class="token operator">=&gt;</span> text<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span>
</code></pre></div><p>事件监听模式：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> pluckCurrentTargetValue<span class="token punctuation">,</span> useObservableState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'observable-hooks'</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> onChange<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useObservableState</span><span class="token punctuation">(</span>pluckCurrentTargetValue<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span> value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Reducer 模式：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useObservableState</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">action$<span class="token punctuation">,</span> initialState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> action$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'INCREMENT'</span><span class="token operator">:</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span>state<span class="token punctuation">,</span>
            <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span>
              <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token keyword">case</span> <span class="token string">'DECREMENT'</span><span class="token operator">:</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span>state<span class="token punctuation">,</span>
            <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">-</span>
              <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
          <span class="token keyword">return</span> state
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> initialState<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'INCREMENT'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'DECREMENT'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="useobservableeagerstate"><a href="#useobservableeagerstate" class="header-anchor">#</a> useObservableEagerState</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token generic-function"><span class="token function">useObservableEagerState</span><span class="token generic class-name"><span class="token operator">&lt;</span>TState<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  state$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TState<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token operator">:</span> TState
</code></pre></div><p>专门优化针对从热的或纯的 Observable（如 <code>BehaviorSubject</code>）中同步地取值，避免触发额外的初次重渲染。</p> <span class="badge tip" style="vertical-align:top;" data-v-59f00772>v3.1.0</span> 添加自 v3.1.0。
<p>这个 hook 会多次 subscribe Observable。第一遍是获取同步产生的值，然后马上 unsubscribe。第二遍是真正的 subscribe。在并行模式下如果渲染被打断可以还会出现多次 subscribe。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>如果 Observable 是冷的且带副作用，这些副作用会被执行至少两次！只有热的或纯的 Observable 可以安全取值。</p></div> <p><strong>类型参数:</strong></p> <ul><li><code>TState</code> 输出的状态</li></ul> <p><strong>参数:</strong></p> <table><thead><tr><th>参数名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>state$</code></td> <td><code>Observable&lt;TState&gt;</code></td> <td>一个 Observable</td></tr></tbody></table> <p><strong>返回值:</strong></p> <p><code>TState</code> 状态值</p> <p><strong>例子:</strong></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> text1$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span>
<span class="token comment">// 'A'</span>
<span class="token keyword">const</span> text1 <span class="token operator">=</span> <span class="token function">useObservableEagerState</span><span class="token punctuation">(</span>text1$<span class="token punctuation">)</span>

<span class="token keyword">const</span> text2$ <span class="token operator">=</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">)</span>
<span class="token comment">// 'C'</span>
<span class="token keyword">const</span> text2 <span class="token operator">=</span> <span class="token function">useObservableEagerState</span><span class="token punctuation">(</span>text2$<span class="token punctuation">)</span>
</code></pre></div><h2 id="uselayoutobservablestate"><a href="#uselayoutobservablestate" class="header-anchor">#</a> useLayoutObservableState</h2> <p><span class="badge tip" style="vertical-align:top;" data-v-59f00772>v4.1.0</span> 添加自 <code>v4.1.0</code>。
</p> <p>与 <a href="#useobservablestate"><code>useObservableState</code></a> 基本一样，不同的是底下使用 <a href="https://reactjs.org/docs/hooks-reference.html#uselayouteffect" target="_blank" rel="noopener noreferrer"><code>useLayoutEffect</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 监听改变。</p> <p>与 <a href="#useobservableeagerstate"><code>useObservableEagerState</code></a> 不一样，<a href="#useobservableeagerstate"><code>useObservableEagerState</code></a> 会在第一次 React 渲染前同步获取值，而 <code>useLayoutObservableState</code> 是在 React 渲染之后同步获取值，<code>useObservableState</code> 则是在 React 渲染并绘制完成之后异步获取值。</p> <p>如果需要在下次浏览器绘制前拿到值可以用它。</p> <p>尽量少用，因为其是在浏览器绘制前同步调用。过多的同步值产生会延长组件的 commit 周期。</p> <h2 id="useobservablegetstate"><a href="#useobservablegetstate" class="header-anchor">#</a> useObservableGetState</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token generic-function"><span class="token function">useObservableGetState</span><span class="token generic class-name"><span class="token operator">&lt;</span>TState<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  state$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TState<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  initialState<span class="token operator">:</span> TState <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TState<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token operator">:</span> TState
<span class="token generic-function"><span class="token function">useObservableGetState</span><span class="token generic class-name"><span class="token operator">&lt;</span>TState<span class="token punctuation">,</span> <span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> TState<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  state$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TState<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  initialState<span class="token operator">:</span> TState<span class="token punctuation">[</span><span class="token constant">A</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TState<span class="token punctuation">[</span><span class="token constant">A</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  pA<span class="token operator">:</span> <span class="token constant">A</span>
<span class="token punctuation">)</span><span class="token operator">:</span> TState<span class="token punctuation">[</span><span class="token constant">A</span><span class="token punctuation">]</span>
<span class="token generic-function"><span class="token function">useObservableGetState</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  TState<span class="token punctuation">,</span>
  <span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> TState<span class="token punctuation">,</span>
  <span class="token constant">B</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> TState<span class="token punctuation">[</span><span class="token constant">A</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  state$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TState<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  initialState<span class="token operator">:</span> TState<span class="token punctuation">[</span><span class="token constant">A</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token constant">B</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TState<span class="token punctuation">[</span><span class="token constant">A</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token constant">B</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  pA<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">,</span>
  pB<span class="token operator">:</span> <span class="token constant">B</span>
<span class="token punctuation">)</span><span class="token operator">:</span> TState<span class="token punctuation">[</span><span class="token constant">A</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token constant">B</span><span class="token punctuation">]</span>
<span class="token operator">...</span>
</code></pre></div><p>类似 lodash 的 <code>get</code>。</p> <p><span class="badge tip" style="vertical-align:top;" data-v-59f00772>v2.3.0</span> 添加自 <code>v2.3.0</code>。通过属性路径从 Observable 状态对象中获得值。
</p> <p><span class="badge tip" style="vertical-align:top;" data-v-59f00772>v3.0.0</span> 添加自 <code>v3.0.0</code>。初始状态必须提供。
</p> <p>只有最终得出的状态发生改变才会触发重渲染。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>不可访问的路径会触发异常。</p></div> <p><strong>类型参数:</strong></p> <ul><li><code>TState</code> 输出的状态值。</li></ul> <p><strong>参数:</strong></p> <table><thead><tr><th>参数名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>state$</code></td> <td><code>Observable&lt;TState&gt;</code></td> <td>一个 Observable。</td></tr> <tr><td><code>initialState</code></td> <td><code>undefined | null | TState[...] | (() =&gt; TState[...])</code></td> <td>初始状态。可以是状态值或者返回状态值的函数。</td></tr> <tr><td><code>pA</code></td> <td><code>keyof TState</code></td> <td>Key of <code>TState</code>.</td></tr> <tr><td><code>pB</code></td> <td><code>keyof TState[A]</code></td> <td>Key of <code>TState[A]</code>.</td></tr> <tr><td><code>pC</code></td> <td><code>keyof TState[A][B]</code></td> <td>Key of <code>TState[A][B]</code>.</td></tr> <tr><td><code>...</code></td> <td><code>...</code></td> <td><code>....</code></td></tr></tbody></table> <p><strong>返回值:</strong></p> <p><code>TState[...]</code> 初始的状态值或者经过路径得到 <code>TState</code> 的属性类型。</p> <p><strong>例子:</strong></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> state$ <span class="token operator">=</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token punctuation">{</span> b<span class="token operator">:</span> <span class="token punctuation">{</span> c<span class="token operator">:</span> <span class="token string">'value'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 第一次渲染：'default'</span>
<span class="token comment">// 第二次渲染：'value'</span>
<span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token function">useObservableGetState</span><span class="token punctuation">(</span>state$<span class="token punctuation">,</span> <span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="useobservablepickstate"><a href="#useobservablepickstate" class="header-anchor">#</a> useObservablePickState</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token generic-function"><span class="token function">useObservablePickState</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  TState<span class="token punctuation">,</span>
  TKeys <span class="token keyword">extends</span> <span class="token keyword">keyof</span> TState<span class="token punctuation">,</span>
  TInitial <span class="token keyword">extends</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">void</span>
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  state$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TState<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  initialState<span class="token operator">:</span> TInitial<span class="token punctuation">,</span>
  <span class="token operator">...</span>keys<span class="token operator">:</span> TKeys<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> TKeys<span class="token punctuation">]</span><span class="token operator">:</span> TState<span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">|</span> TInitial
<span class="token generic-function"><span class="token function">useObservablePickState</span><span class="token generic class-name"><span class="token operator">&lt;</span>TState<span class="token punctuation">,</span> TKeys <span class="token keyword">extends</span> <span class="token keyword">keyof</span> TState<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  state$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TState<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  initialState<span class="token operator">:</span>
    <span class="token operator">|</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> TKeys<span class="token punctuation">]</span><span class="token operator">:</span> TState<span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> TKeys<span class="token punctuation">]</span><span class="token operator">:</span> TState<span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>keys<span class="token operator">:</span> TKeys<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> TKeys<span class="token punctuation">]</span><span class="token operator">:</span> TState<span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
</code></pre></div><p>类似 lodash 的 <code>pick</code>。</p> <p><span class="badge tip" style="vertical-align:top;" data-v-59f00772>v2.3.2</span> 添加自 <code>v2.3.2</code>。从一个状态对象中挑选属性组合成新的对象。
</p> <p><span class="badge tip" style="vertical-align:top;" data-v-59f00772>v3.0.0</span> 添加自 <code>v3.0.0</code>。初始状态必须提供。
</p> <p>挑选出的属性任一发生变化都会触发重渲染。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>不可访问的路径会触发异常。</p></div> <p><strong>类型参数:</strong></p> <ul><li><code>TState</code> 输出的状态</li> <li><code>TKeys</code> 挑选的状态键名</li></ul> <p><strong>参数:</strong></p> <table><thead><tr><th>参数名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>state$</code></td> <td><code>Observable&lt;TState&gt;</code></td> <td>一个 Observable。</td></tr> <tr><td><code>initialState</code></td> <td><code>undefined | null | { [K in TKeys]: TState[K] } | (() =&gt; { [K in TKeys]: TState[K] })</code></td> <td>初始状态。可以是状态值或者返回状态值的函数。</td></tr> <tr><td><code>...path</code></td> <td><code>Array&lt;keyof TState&gt;</code></td> <td>挑选的 <code>TState</code> 键名。</td></tr></tbody></table> <p><strong>返回值:</strong></p> <p><code>{ [K in TKeys]: TState[K] }</code> Initial value or partial <code>TState</code>.</p> <p><strong>例子:</strong></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> state$ <span class="token operator">=</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token string">'c'</span><span class="token punctuation">,</span> d<span class="token operator">:</span> <span class="token string">'d'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 第一次渲染：{ a: '', b: '', c: '' }</span>
<span class="token comment">// 第二次渲染：{ a: 'a', b: 'b', c: 'c' }</span>
<span class="token keyword">const</span> picked <span class="token operator">=</span> <span class="token function">useObservablePickState</span><span class="token punctuation">(</span>
  state$<span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span>
<span class="token punctuation">)</span>
</code></pre></div><h2 id="userenderthrow"><a href="#userenderthrow" class="header-anchor">#</a> useRenderThrow</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token generic-function"><span class="token function">useRenderThrow</span><span class="token generic class-name"><span class="token operator">&lt;</span>TInput<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>input$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TInput<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>TInput<span class="token operator">&gt;</span> 
</code></pre></div><p>捕获 Observable 异常并重新以 React 渲染异常抛出，从而被上层错误边界（Error Boundary）捕获处理。</p> <p><span class="badge tip" style="vertical-align:top;" data-v-59f00772>v4.2.0</span> 添加自 <code>v4.2.0</code>.
</p> <p><strong>类型参数:</strong></p> <ul><li><code>TInput</code> Input Observable</li></ul> <p><strong>参数:</strong></p> <table><thead><tr><th>参数名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>input$</code></td> <td><code>Observable&lt;TInput&gt;</code></td> <td>An Observable.</td></tr></tbody></table> <p><strong>返回值:</strong></p> <p><code>Observable&lt;TInput&gt;</code> An Observable.</p> <p><strong>例子:</strong></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> state$ <span class="token operator">=</span> <span class="token function">useObservable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token string">'c'</span><span class="token punctuation">,</span> d<span class="token operator">:</span> <span class="token string">'d'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> enhanced$ <span class="token operator">=</span> <span class="token function">useRenderThrow</span><span class="token punctuation">(</span>state$<span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/crimx/observable-hooks/edit/master/docs/zh-cn/api/README.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/zh-cn/api/suspense.html">
        Suspense
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.9db4870b.js" defer></script><script src="/assets/js/2.393da890.js" defer></script><script src="/assets/js/1.05c5d22f.js" defer></script><script src="/assets/js/37.493f2dcd.js" defer></script><script src="/assets/js/4.7886ae13.js" defer></script><script src="/assets/js/18.d18af064.js" defer></script>
  </body>
</html>
